# Garbage Collection



## 什么是Garbage (垃圾)

* 垃圾是指在运行程序中没有任何指针指向的对象，这个对象就是需要被回收的垃圾



## Key Problems:

* 什么是垃圾
* 什么时候回收♻️垃圾
* 如何回收垃圾



## 一个对象存在的3种状态: 因为finalize( )的原因

* 可触及的:  从GC Roots根节点开始，可以直接或间接地达到这个对象
* 可复活的:  对象的所有引用都被释放，但是对象有可能在finalize( )中复活
* 不可触及的:  对象的finalize( )被调用，并且没有复活，那么就会进入不可触及状态。不可触及的对象不可能被复活，因为finalize( )只会被调用一次



## 判断一个对象obj是否可回收，至少要经历2次标记过程:

1. 如果对象obj到GC Roots没有引用链，则 进行第一次标记
2. 进行筛选，判断此对象是否有必要执行finalize( )方法
    a. 如果对象obj没有重写finalize( )方法，或者finalize( )方法已经被虚拟机调用过，则虚拟机视为"没有必要执行", obj被判定为不可触及的
    b. 如果对象重写了finalize( )方法，且还未执行过，那么obj会被插入到F-Queue队列中，有一个虚拟机自动创建的, 低优先级的Finalizer线程触发其finalize( )方法执行
    c. finalize( )方法是对象逃脱死亡的最后机会，稍后GC会对F-Queue队列中的对象进行第二次标记，如果obj在finalize( )方法中与引用链上的任何一个对象建立了联系，那么在第二次标记时，obj会被移出"即将回收"集合。之后，对象若再次出现没有引用存在的情况，finalize方法不会再被调用，对象会直接变成不可触及状态，也就是说，一个对象的finalize方法只会被调用一次


